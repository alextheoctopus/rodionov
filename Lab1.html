<!DOCTYPE html>
<html>

<head>
    <meta charset='utf-8'>
    <title>Page Title</title>
</head>

<style>
    input {
        border-color: rgb(219, 219, 219);
        padding: 5px;
        margin: 2px;
        border-radius: 3px;
        outline: 0;
        width: 100px;
    }

    #matrixOutput {
        background-color: rgb(235, 235, 235);
        padding: 10px;
        margin-top: 10px;
    }

    button {
        background-color: rgb(212, 212, 212);
        outline: 0;
        border: 0;
        padding: 7px;
        margin: 2px;
        border-radius: 3px;
    }

    button:hover {
        box-shadow: rgb(138, 138, 138) 1px 1px 3px 1px;
    }

    .smallInputs {
        width: 25px;
        border-radius: 3px;
    }

    .smallInputsReadOnly,
    .smallInputsClmn,
    .smallInputsStr {
        width: 25px;
        border-radius: 3px;
        color: gray;
    }
</style>

<body>
    <div id="matrixOutput">
        <input id="matrixWidth" placeholder="кол-во столбцов">
        <input id="matrixHeight" placeholder="кол-во строк">
        <button id="genMatrix">Создать матрицу</button>
    </div>

    <script>

        const matrixOutput = document.getElementById("matrixOutput");
        const genMatrixBtn = document.getElementById("genMatrix");
        const matrixWidthInput = document.getElementById("matrixWidth");
        const matrixHeightInput = document.getElementById("matrixHeight");
        const okBtn = document.createElement('button');
        const inputK = document.createElement('input');
        const inputS = document.createElement('input');
        const strokeDiv = document.createElement('div');
        const columnDiv = document.createElement('div');

        let width;
        let height;
        let columnArr = [];
        let strokeArr = [];

        genMatrixBtn.addEventListener('click', () => {
            matrixOutput.innerHTML = '';
            matrixOutput.innerHTML += 'Задайте матрицу коэффициентов: ';
            width = matrixWidthInput.value - 0;
            height = matrixHeightInput.value - 0;
            columnDiv.width = '30px';
            matrixOutput.appendChild(strokeDiv);
            matrixOutput.appendChild(columnDiv);
            for (let i = 0; i < height + 1; i++) {
                const str = document.createElement('div');
                for (let j = 0; j < width + 1; j++) {
                    const field = document.createElement('input');
                    if (j == 0 && i == 0) {
                        field.setAttribute('class', 'smallInputsReadOnly');
                        field.setAttribute('value', '');
                        str.appendChild(field);
                    }
                    if (i == 0 && j != 0) {
                        let ind = j;
                        field.setAttribute('readonly', 'true');
                        field.setAttribute('class', 'smallInputsStr');
                        if (j == 1) {
                            field.setAttribute('value', '1');
                            strokeArr.push('1');
                        } else {
                            field.setAttribute('value', '-x' + (ind - 1));
                            strokeArr.push('-x' + (ind - 1));
                        }
                        str.appendChild(field);
                    }
                    if (j == 0 && i != 0) {
                        columnArr.push('0');
                        field.setAttribute('readonly', 'true');
                        field.setAttribute('class', 'smallInputsClmn');
                        field.setAttribute('placeholder', '0');
                        str.appendChild(field);
                    }
                    if (j != 0 && i != 0) {
                        field.setAttribute('class', 'smallInputs');
                        field.setAttribute('placeholder', '0');
                        str.appendChild(field);
                    }
                }
                matrixOutput.appendChild(str);
            }
            matrixOutput.innerHTML += 'Задайте разрешающий элемент: ';

            const inputs = document.querySelectorAll('.smallInputs');
            inputs.forEach((input, i, inputs) => input.addEventListener('keydown', () => {
                if (event.keyCode == '39') {
                    if (inputs[i + 1]) inputs[i + 1].focus();
                } else if (event.keyCode == '37') {
                    if (inputs[i - 1]) inputs[i - 1].focus();
                }
            }));

            inputK.setAttribute('placeholder', 'столбец');
            matrixOutput.appendChild(inputK);

            inputS.setAttribute('placeholder', 'строка');
            matrixOutput.appendChild(inputS);

            okBtn.innerHTML = 'OK';
            matrixOutput.appendChild(okBtn);

        });

        let matrixA = [];
        let matrixB = [];

        const switchElems = (matrixA, s, k) => {
            for (let i = 0; i < matrixA.length; i++) {
                matrixB.push(matrixA[i].slice());
            }
            const a = matrixA[k][s];
            matrixB[k][s] = 1 / a;
            matrixB[k].forEach((elem, i) => {
                if (i != s) {
                    matrixB[k][i] = elem / a;
                }
            }
            );
            matrixB.forEach((str, i) => {
                if (i != k)
                    str[s] /= -a;
            });
            for (let i = 0; i < matrixA.length; i++) {
                if (i != k) {
                    for (let j = 0; j < matrixA[i].length; j++) {
                        if (j != s) {
                            matrixB[i][j] = matrixA[i][j] - (matrixA[i][s] * matrixA[k][j] / a);
                        }
                    }
                }
            }
            return matrixB;
        }

        let flag = true;
        let matrixForbidden = [];
        okBtn.addEventListener('click', () => {

            let inputs = document.querySelectorAll('.smallInputs');
            const inputsClmn = document.querySelectorAll('.smallInputsClmn');
            const inputsStr = document.querySelectorAll('.smallInputsStr');

            // записываем значения из инпутов в двумерный массив
            if (flag) {
                for (let j = 0; j < inputsClmn.length; j++) {
                    const str = [];
                    for (let i = j * inputsStr.length; i < j * inputsStr.length + inputsStr.length; i++) {
                        str.push(inputs[i].value - 0);
                    }
                    matrixA.push(str);
                }
            }

            // индексы разрешающего элемента
            const k = inputK.value - 1;
            const s = inputS.value - 1;
            //console.log(s);
            //console.log(matrixForbidden);
            //console.log(matrixForbidden.indexOf(s));
            if (matrixA[s][k] != 0 && matrixForbidden.indexOf(s) == -1 && k != 0) {
                // заполняем массивы для первой строки и первого столбца (нули и иксы)
                console.log(k, s);
                let temp = columnArr[s];
                console.log("Строка ", temp);
                columnArr[s] = strokeArr[k].split('').splice(1, 3).join('');
                strokeArr[k] = temp;
                console.log("Колонка ", strokeArr);

                strokeDiv.innerHTML = strokeArr;
                columnDiv.innerHTML = columnArr;

                // выполняем преобразование матрицы коэффициентов
                matrixB = [];
                matrixB = switchElems(matrixA, k, s);

                // удаляем из матрицы В столбец (каждый k-ый элемент)
                for (let i = 0; i < matrixB.length; i++) {
                    matrixB[i].splice(k, 1);
                }

                // матрица А = матрица В
                matrixA = [];
                for (let i = 0; i < matrixB.length; i++) {
                    matrixA.push(matrixB[i].slice());
                }

                // преобразуем матрицу В в одномерный массив
                let arr2 = matrixB.flat();

                // удаляем лишние инпуты
                for (let i = k; i < inputs.length; i += inputsStr.length) {
                    inputs[i].remove();
                }
                inputsStr[k].parentElement.removeChild(inputsStr[k]);

                // заполняем первую строку и первый столбец (нули и иксы)
                inputsStr.forEach((input, index) => {
                    input.value = strokeArr[index];
                });
                inputsClmn.forEach((input, index) => {
                    input.value = columnArr[index];
                });
                // удаляем лишний элемент массива из строки первой(нулевой удаляем)
                let deleteSymb = strokeArr.indexOf('0');
                console.log(strokeArr[deleteSymb]);
                strokeArr.splice(deleteSymb, 1);

                // заполняем инпуты (матрица коэффициентов)
                document.querySelectorAll('.smallInputs').forEach((input, index) => {
                    input.value = arr2[index];
                });

                //запрещаем пользователю выбирать одну строку дважды
                matrixForbidden.push(s);

                let z1 = columnArr.indexOf('0');
                let d = 0;
                if (matrixB[z1]) {
                    matrixB[z1].forEach((value) => { if (value == 0) { d++ } });
                    if (d == 3) {
                        matrixOutput.innerHTML += showAnswer(matrixB);
                    }
                }

            } else {
                if (matrixA[s][k] == 0) alert("Введите ненулевой элемент")
                else if (matrixForbidden.indexOf(s) + 1) alert("Выберите другую строку")
                else if (k == 0) alert("Выберите другой столбец")
            }

            flag = false;
        });

        const showAnswer = (matrix) => {
            return `<p>x1 = ${matrix[0][1]}a</p>
            <p>x2 = ${matrix[0][2]}a </p>
            <p>x3 = ${matrix[0][0]} - ${matrix[0][1]}a - ${matrix[0][1]}b </p>
            <p>x3 = ${matrix[1][0]} - ${matrix[1][1]}a - ${matrix[1][1]}b </p>`
        }


    </script>
</body>

</html>